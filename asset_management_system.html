<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ë¸Œë¼ë³´ë¹„ë²„íŒŒì£¼ ìì‚°ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box;}
        body { font-family: 'Arial', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px;}
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); padding: 30px;}
        .header { text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 3px solid #667eea;}
        .header h1 { color: #333; font-size: 2.5em; margin-bottom: 10px;}
        .header p { color: #666; font-size: 1.1em;}
        .tabs { display: flex; margin-bottom: 30px; background: #f8f9fa; border-radius: 10px; padding: 5px;}
        .tab-button { flex: 1; padding: 15px 20px; border: none; background: transparent; cursor: pointer; border-radius: 8px; font-weight: bold; transition: all 0.3s ease; color: #666;}
        .tab-button.active { background: #667eea; color: white; box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);}
        .tab-content { display: none;}
        .tab-content.active { display: block;}
        .form-group { margin-bottom: 20px;}
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #333;}
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px; transition: border-color 0.3s ease;}
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);}
        .btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; transition: transform 0.2s ease; margin-right: 10px; margin-bottom: 10px;}
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);}
        .btn-secondary { background: #6c757d;}
        .btn-danger { background: #dc3545;}
        .btn-success { background: #28a745;}
        .asset-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;}
        .asset-card { background: white; border: 2px solid #e1e5e9; border-radius: 10px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); transition: transform 0.2s ease;}
        .asset-card:hover {transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.15);}
        .asset-card h3 { color: #333; margin-bottom: 10px; font-size: 1.3em;}
        .asset-info { margin-bottom: 15px;}
        .asset-info span { display: block; margin-bottom: 5px; color: #666;}
        .qr-code { text-align: center; margin: 15px 0;}
        .qr-code canvas { border: 1px solid #ddd; border-radius: 8px;}
        .search-box { width: 100%; padding: 15px; font-size: 18px; border: 2px solid #667eea; border-radius: 10px; margin-bottom: 20px;}
        .search-box:focus { outline: none; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);}
        .stats {display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;}
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 10px; text-align: center;}
        .stat-card h3 { font-size: 2em; margin-bottom: 5px;}
        .stat-card p { font-size: 1.1em; opacity: 0.9;}
        .camera-container { text-align: center; margin: 20px 0;}
        #video { width: 100%; max-width: 500px; border: 2px solid #667eea; border-radius: 10px;}
        .export-section { margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;}
        @media (max-width: 768px) {
            .container { padding: 20px;}
            .tabs { flex-direction: column;}
            .tab-button { margin-bottom: 5px;}
            .asset-grid { grid-template-columns: 1fr;}
        }
        /* ìˆ˜ì • ëª¨ë‹¬ */
        #edit-modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0; top: 0;
            width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.3);
            justify-content: center;
            align-items: center;
        }
        #edit-modal > div {
            background: white;
            padding: 30px;
            border-radius: 14px;
            min-width: 350px;
            max-width: 95vw;
            position: relative;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¢ ë¸Œë¼ë³´ë¹„ë²„íŒŒì£¼ ìì‚°ê´€ë¦¬ì‹œìŠ¤í…œ</h1>
            <p>QR ì½”ë“œ ê¸°ë°˜ ìì‚° ê´€ë¦¬ ì†”ë£¨ì…˜</p>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="showTab('add', this)">ìì‚° ë“±ë¡</button>
            <button class="tab-button" onclick="showTab('list', this)">ìì‚° ëª©ë¡</button>
            <button class="tab-button" onclick="showTab('scan', this)">QR ìŠ¤ìº”</button>
            <button class="tab-button" onclick="showTab('stats', this)">í†µê³„</button>
        </div>

        <!-- ìì‚° ë“±ë¡ íƒ­ -->
        <div id="add-tab" class="tab-content active">
            <h2>ğŸ”¥ ìƒˆ ìì‚° ë“±ë¡</h2>
            <form id="asset-form">
                <div class="form-group">
                    <label for="assetName">ìì‚°ëª… *</label>
                    <input type="text" id="assetName" name="assetName" required placeholder="ì˜ˆ: ë…¸íŠ¸ë¶, ì±…ìƒ, ì˜ì ë“±">
                </div>
                <div class="form-group">
                    <label for="modelName">ëª¨ë¸ëª…</label>
                    <input type="text" id="modelName" name="modelName" placeholder="ì˜ˆ: ThinkPad X1 Carbon">
                </div>
                <div class="form-group">
                    <label for="serialNumber">ì‹œë¦¬ì–¼ë„˜ë²„</label>
                    <input type="text" id="serialNumber" name="serialNumber" placeholder="ì˜ˆ: SN1234567890">
                </div>
                <div class="form-group">
                    <label for="assetCategory">ì¹´í…Œê³ ë¦¬ *</label>
                    <select id="assetCategory" name="assetCategory" required>
                        <option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
                        <option value="ì „ìê¸°ê¸°">ì „ìê¸°ê¸°</option>
                        <option value="ì‚¬ë¬´ìš©í’ˆ">ì‚¬ë¬´ìš©í’ˆ</option>
                        <option value="ê°€êµ¬">ê°€êµ¬</option>
                        <option value="ê¸°ê³„ì¥ë¹„">ê¸°ê³„ì¥ë¹„</option>
                        <option value="ì°¨ëŸ‰">ì°¨ëŸ‰</option>
                        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="assetLocation">ìœ„ì¹˜ *</label>
                    <select id="assetLocation" name="assetLocation" required>
                        <option value="">ìœ„ì¹˜ ì„ íƒ</option>
                        <option value="ì‚¬ë¬´ì‹¤">ì‚¬ë¬´ì‹¤</option>
                        <option value="ì‘ì—…ì¥">ì‘ì—…ì¥</option>
                        <option value="ê·¸ë¼ìš´ë“œ">ê·¸ë¼ìš´ë“œ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="assetValue">ìì‚°ê°€ì¹˜ (ì›)</label>
                    <input type="number" id="assetValue" name="assetValue" placeholder="ì˜ˆ: 500000">
                </div>
                <div class="form-group">
                    <label for="purchaseDate">êµ¬ì…ì¼ì</label>
                    <input type="date" id="purchaseDate" name="purchaseDate">
                </div>
                <div class="form-group">
                    <label for="assetDescription">ì„¤ëª…</label>
                    <textarea id="assetDescription" name="assetDescription" rows="3" placeholder="ìì‚°ì— ëŒ€í•œ ì¶”ê°€ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>
                <button type="submit" class="btn">ìì‚° ë“±ë¡ ë° QRì½”ë“œ ìƒì„±</button>
            </form>
        </div>

        <!-- ìì‚° ëª©ë¡ íƒ­ -->
        <div id="list-tab" class="tab-content">
            <h2>ğŸ“‹ ìì‚° ëª©ë¡</h2>
            <input type="text" id="searchInput" class="search-box" placeholder="ğŸ” ìì‚°ëª…, ì¹´í…Œê³ ë¦¬, ìœ„ì¹˜ë¡œ ê²€ìƒ‰í•˜ì„¸ìš”...">

            <div class="export-section">
                <h3>ğŸ“Š ë°ì´í„° ë‚´ë³´ë‚´ê¸°</h3>
                <button class="btn btn-success" onclick="exportToCSV()">CSV íŒŒì¼ ë‹¤ìš´ë¡œë“œ</button>
                <button class="btn btn-secondary" onclick="printAssets()">ëª©ë¡ ì¸ì‡„</button>
            </div>

            <div id="asset-list" class="asset-grid"></div>
        </div>

        <!-- QR ìŠ¤ìº” íƒ­ -->
        <div id="scan-tab" class="tab-content">
            <h2>ğŸ“± QR ì½”ë“œ ìŠ¤ìº”</h2>
            <div class="camera-container">
                <video id="video" autoplay></video>
                <canvas id="canvas" style="display:none;"></canvas>
            </div>
            <button class="btn" onclick="startCamera()">ì¹´ë©”ë¼ ì‹œì‘</button>
            <button class="btn btn-secondary" onclick="stopCamera()">ì¹´ë©”ë¼ ì¤‘ì§€</button>
            <div id="scan-result"></div>
        </div>

        <!-- í†µê³„ íƒ­ -->
        <div id="stats-tab" class="tab-content">
            <h2>ğŸ“Š ìì‚° í†µê³„</h2>
            <div class="stats">
                <div class="stat-card">
                    <h3 id="total-assets">0</h3>
                    <p>ì´ ìì‚° ìˆ˜</p>
                </div>
                <div class="stat-card">
                    <h3 id="total-value">0ì›</h3>
                    <p>ì´ ìì‚° ê°€ì¹˜</p>
                </div>
                <div class="stat-card">
                    <h3 id="categories-count">0</h3>
                    <p>ì¹´í…Œê³ ë¦¬ ìˆ˜</p>
                </div>
                <div class="stat-card">
                    <h3 id="locations-count">3</h3>
                    <p>ìœ„ì¹˜ ìˆ˜</p>
                </div>
            </div>
            <div id="category-stats"></div>
            <div id="location-stats"></div>
        </div>
    </div>

    <!-- ìì‚° ì •ë³´ ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="edit-modal">
        <div>
            <form id="edit-form">
                <h2>ìì‚° ì •ë³´ ìˆ˜ì •</h2>
                <input type="hidden" id="edit-id" />
                <div class="form-group">
                    <label>ìì‚°ëª… *</label>
                    <input type="text" id="edit-assetName" required />
                </div>
                <div class="form-group">
                    <label>ëª¨ë¸ëª…</label>
                    <input type="text" id="edit-modelName" />
                </div>
                <div class="form-group">
                    <label>ì‹œë¦¬ì–¼ë„˜ë²„</label>
                    <input type="text" id="edit-serialNumber" />
                </div>
                <div class="form-group">
                    <label>ì¹´í…Œê³ ë¦¬ *</label>
                    <select id="edit-assetCategory" required>
                        <option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
                        <option value="ì „ìê¸°ê¸°">ì „ìê¸°ê¸°</option>
                        <option value="ì‚¬ë¬´ìš©í’ˆ">ì‚¬ë¬´ìš©í’ˆ</option>
                        <option value="ê°€êµ¬">ê°€êµ¬</option>
                        <option value="ê¸°ê³„ì¥ë¹„">ê¸°ê³„ì¥ë¹„</option>
                        <option value="ì°¨ëŸ‰">ì°¨ëŸ‰</option>
                        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ìœ„ì¹˜ *</label>
                    <select id="edit-assetLocation" required>
                        <option value="">ìœ„ì¹˜ ì„ íƒ</option>
                        <option value="ì‚¬ë¬´ì‹¤">ì‚¬ë¬´ì‹¤</option>
                        <option value="ì‘ì—…ì¥">ì‘ì—…ì¥</option>
                        <option value="ê·¸ë¼ìš´ë“œ">ê·¸ë¼ìš´ë“œ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ê°€ì¹˜ (ì›)</label>
                    <input type="number" id="edit-assetValue" />
                </div>
                <div class="form-group">
                    <label>êµ¬ì…ì¼ì</label>
                    <input type="date" id="edit-purchaseDate" />
                </div>
                <div class="form-group">
                    <label>ì„¤ëª…</label>
                    <textarea id="edit-assetDescription" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-success">ì €ì¥</button>
                <button type="button" class="btn btn-secondary" onclick="closeEditModal()">ì·¨ì†Œ</button>
            </form>
        </div>
    </div>

    <script>
        // ì•ˆì „í•˜ê²Œ localStorageì—ì„œ ë°ì´í„° ì½ê¸°
        let assets = [];
        const storedAssets = localStorage.getItem('assets');
        if (storedAssets) {
            try {
                assets = JSON.parse(storedAssets);
            } catch {
                assets = [];
            }
        }

        let videoStream = null;

        // íƒ­ ì „í™˜í•¨ìˆ˜
        function showTab(tabName, buttonElem) {
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
            buttonElem.classList.add('active');
            if (tabName === 'list') displayAssets();
            if (tabName === 'stats') updateStats();
        }

        // ìì‚° ë“±ë¡
        document.getElementById('asset-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const asset = {
                id: Date.now().toString(),
                name: formData.get('assetName'),
                modelName: formData.get('modelName'),
                serialNumber: formData.get('serialNumber'),
                category: formData.get('assetCategory'),
                location: formData.get('assetLocation'),
                value: parseInt(formData.get('assetValue')) || 0,
                purchaseDate: formData.get('purchaseDate'),
                description: formData.get('assetDescription'),
                registrationDate: new Date().toISOString().split('T')[0]
            };
            assets.push(asset);
            localStorage.setItem('assets', JSON.stringify(assets));
            alert('ìì‚°ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
            e.target.reset();
        });

        // ìì‚° ëª©ë¡ í‘œì‹œ
        function displayAssets(filteredAssets = null) {
            const assetList = document.getElementById('asset-list');
            const assetsToShow = filteredAssets || assets;
            if (assetsToShow.length === 0) {
                assetList.innerHTML = '<div style="text-align: center; padding: 50px; color: #666;">ë“±ë¡ëœ ìì‚°ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            assetList.innerHTML = assetsToShow.map(asset => `
                <div class="asset-card">
                    <h3>${asset.name}</h3>
                    <div class="asset-info">
                        <span><strong>ëª¨ë¸ëª…:</strong> ${asset.modelName || 'ë¯¸ì…ë ¥'}</span>
                        <span><strong>ì‹œë¦¬ì–¼ë„˜ë²„:</strong> ${asset.serialNumber || 'ë¯¸ì…ë ¥'}</span>
                        <span><strong>ì¹´í…Œê³ ë¦¬:</strong> ${asset.category}</span>
                        <span><strong>ìœ„ì¹˜:</strong> ${asset.location}</span>
                        <span><strong>ê°€ì¹˜:</strong> ${asset.value ? asset.value.toLocaleString() + 'ì›' : 'ë¯¸ì…ë ¥'}</span>
                        <span><strong>êµ¬ì…ì¼:</strong> ${asset.purchaseDate || 'ë¯¸ì…ë ¥'}</span>
                        <span><strong>ë“±ë¡ì¼:</strong> ${asset.registrationDate}</span>
                        ${asset.description ? `<span><strong>ì„¤ëª…:</strong> ${asset.description}</span>` : ''}
                    </div>
                    <div class="qr-code" id="qr-${asset.id}"></div>
                    <button class="btn btn-danger" onclick="deleteAsset('${asset.id}')">ì‚­ì œ</button>
                    <button class="btn btn-secondary" onclick="downloadQR('${asset.id}')">QR ë‹¤ìš´ë¡œë“œ</button>
                    <button class="btn btn-secondary" onclick="editAsset('${asset.id}')">ìˆ˜ì •</button>
                </div>
            `).join('');
            assetsToShow.forEach(asset => {
                const qrData = JSON.stringify({
                    id: asset.id,
                    name: asset.name,
                    modelName: asset.modelName,
                    serialNumber: asset.serialNumber,
                    category: asset.category,
                    location: asset.location
                });
                QRCode.toCanvas(document.getElementById(`qr-${asset.id}`), qrData, {
                    width: 150,
                    margin: 1,
                    color: { dark: '#000000', light: '#FFFFFF' }
                }, function (error) {
                    if (error) console.error(error);
                });
            });
        }

        // ìì‚° ì‚­ì œ
        function deleteAsset(id) {
            if (confirm('ì •ë§ë¡œ ì´ ìì‚°ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                assets = assets.filter(asset => asset.id !== id);
                localStorage.setItem('assets', JSON.stringify(assets));
                displayAssets();
                updateStats();
            }
        }

        // QR ì½”ë“œ ë‹¤ìš´ë¡œë“œ PNG
        function downloadQR(id) {
            const canvas = document.querySelector(`#qr-${id} canvas`);
            if (canvas) {
                const link = document.createElement('a');
                link.download = `qr-code-${id}.png`;
                link.href = canvas.toDataURL();
                link.click();
            }
        }

        // ê²€ìƒ‰ í•„í„°
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const filteredAssets = assets.filter(asset => 
                asset.name.toLowerCase().includes(searchTerm) ||
                asset.category.toLowerCase().includes(searchTerm) ||
                asset.location.toLowerCase().includes(searchTerm) ||
                (asset.description && asset.description.toLowerCase().includes(searchTerm)) ||
                (asset.modelName && asset.modelName.toLowerCase().includes(searchTerm)) ||
                (asset.serialNumber && asset.serialNumber.toLowerCase().includes(searchTerm))
            );
            displayAssets(filteredAssets);
        });

        // CSV ë‹¤ìš´ë¡œë“œ(í•œê¸€ê¹¨ì§ ë° QRì½”ë“œ í¬í•¨)
        async function exportToCSV() {
            if (assets.length === 0) {
                alert('ë‚´ë³´ë‚¼ ìì‚°ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            const headers = ['ìì‚°ëª…','ëª¨ë¸ëª…','ì‹œë¦¬ì–¼ë„˜ë²„','ì¹´í…Œê³ ë¦¬','ìœ„ì¹˜','ê°€ì¹˜','êµ¬ì…ì¼','ë“±ë¡ì¼','ì„¤ëª…','QRì½”ë“œ(Base64)'];

            async function getQRCodeDataURL(asset) {
                const qrData = JSON.stringify({
                    id: asset.id,
                    name: asset.name,
                    modelName: asset.modelName,
                    serialNumber: asset.serialNumber,
                    category: asset.category,
                    location: asset.location
                });
                return new Promise((resolve) => {
                    const canvas = document.createElement('canvas');
                    QRCode.toCanvas(canvas, qrData, { width: 150, margin: 1 }, (error) => {
                        if (error) return resolve('');
                        resolve(canvas.toDataURL());
                    });
                });
            }

            const csvRows = [];
            for (const asset of assets) {
                const qrCodeDataURL = await getQRCodeDataURL(asset);
                const row = [
                    `"${asset.name.replace(/"/g, '""')}"`,
                    `"${(asset.modelName || '').replace(/"/g, '""')}"`,
                    `"${(asset.serialNumber || '').replace(/"/g, '""')}"`,
                    `"${asset.category}"`,
                    `"${asset.location}"`,
                    asset.value || 0,
                    asset.purchaseDate || '',
                    asset.registrationDate,
                    `"${(asset.description || '').replace(/"/g, '""')}"`,
                    `"${qrCodeDataURL}"`
                ].join(',');
                csvRows.push(row);
            }

            const BOM = '\uFEFF';
            const csvContent = BOM + [headers.join(','), ...csvRows].join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `ë¸Œë¼ë³´ë¹„ë²„íŒŒì£¼_ìì‚°ëª©ë¡_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        // ì¸ì‡„
        function printAssets() {
            window.print();
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            document.getElementById('total-assets').textContent = assets.length;
            const totalValue = assets.reduce((sum, asset) => sum + (asset.value || 0), 0);
            document.getElementById('total-value').textContent = totalValue.toLocaleString() + 'ì›';
            const categories = [...new Set(assets.map(asset => asset.category))];
            document.getElementById('categories-count').textContent = categories.length;
            const categoryStats = document.getElementById('category-stats');
            const categoryData = categories.map(category => ({
                category,
                count: assets.filter(asset => asset.category === category).length
            }));
            categoryStats.innerHTML = `
                <h3>ì¹´í…Œê³ ë¦¬ë³„ ë¶„í¬</h3>
                <div class="asset-grid">
                    ${categoryData.map(data => `
                        <div class="asset-card">
                            <h4>${data.category}</h4>
                            <p>${data.count}ê°œ</p>
                        </div>
                    `).join('')}
                </div>
            `;
            const locations = ['ì‚¬ë¬´ì‹¤','ì‘ì—…ì¥','ê·¸ë¼ìš´ë“œ'];
            const locationStats = document.getElementById('location-stats');
            const locationData = locations.map(location => ({
                location,
                count: assets.filter(asset => asset.location === location).length
            }));
            locationStats.innerHTML = `
                <h3>ìœ„ì¹˜ë³„ ë¶„í¬</h3>
                <div class="asset-grid">
                    ${locationData.map(data => `
                        <div class="asset-card">
                            <h4>${data.location}</h4>
                            <p>${data.count}ê°œ</p>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // ì¹´ë©”ë¼ ì‹œì‘
        async function startCamera() {
            try {
                videoStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                const video = document.getElementById('video');
                video.srcObject = videoStream;
                video.play();
                scanQRCode();
            } catch (error) {
                alert('ì¹´ë©”ë¼ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ì¹´ë©”ë¼ ì¤‘ì§€
        function stopCamera() {
            if (videoStream) {
                videoStream.getTracks().forEach(track => track.stop());
                videoStream = null;
            }
        }

        // QR ì½”ë“œ ìŠ¤ìº”
        function scanQRCode() {
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');
            if (video.readyState === video.HAVE_ENOUGH_DATA) {
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                context.drawImage(video, 0, 0, canvas.width, canvas.height);
                const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
                const code = jsQR(imageData.data, imageData.width, imageData.height);
                if (code) {
                    try {
                        const qrData = JSON.parse(code.data);
                        const asset = assets.find(a => a.id === qrData.id);
                        if (asset) {
                            document.getElementById('scan-result').innerHTML = `
                                <div class="asset-card">
                                    <h3>âœ… ìì‚° ì •ë³´</h3>
                                    <div class="asset-info">
                                        <span><strong>ìì‚°ëª…:</strong> ${asset.name}</span>
                                        <span><strong>ëª¨ë¸ëª…:</strong> ${asset.modelName || 'ë¯¸ì…ë ¥'}</span>
                                        <span><strong>ì‹œë¦¬ì–¼ë„˜ë²„:</strong> ${asset.serialNumber || 'ë¯¸ì…ë ¥'}</span>
                                        <span><strong>ì¹´í…Œê³ ë¦¬:</strong> ${asset.category}</span>
                                        <span><strong>ìœ„ì¹˜:</strong> ${asset.location}</span>
                                        <span><strong>ê°€ì¹˜:</strong> ${asset.value ? asset.value.toLocaleString() + 'ì›' : 'ë¯¸ì…ë ¥'}</span>
                                        <span><strong>êµ¬ì…ì¼:</strong> ${asset.purchaseDate || 'ë¯¸ì…ë ¥'}</span>
                                    </div>
                                </div>
                            `;
                        } else {
                            document.getElementById('scan-result').innerHTML = '<div class="asset-card"><h3>âŒ í•´ë‹¹ ìì‚°ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</h3></div>';
                        }
                    } catch (error) {
                        document.getElementById('scan-result').innerHTML = '<div class="asset-card"><h3>âŒ ì˜¬ë°”ë¥´ì§€ ì•Šì€ QR ì½”ë“œì…ë‹ˆë‹¤.</h3></div>';
                    }
                }
            }
            if (videoStream) requestAnimationFrame(scanQRCode);
        }

        // ìì‚° ì •ë³´ ìˆ˜ì • í•¨ìˆ˜
        function editAsset(id) {
            const asset = assets.find(a => a.id === id);
            if (!asset) return;
            document.getElementById('edit-id').value = asset.id;
            document.getElementById('edit-assetName').value = asset.name;
            document.getElementById('edit-modelName').value = asset.modelName || '';
            document.getElementById('edit-serialNumber').value = asset.serialNumber || '';
            document.getElementById('edit-assetCategory').value = asset.category;
            document.getElementById('edit-assetLocation').value = asset.location;
            document.getElementById('edit-assetValue').value = asset.value || '';
            document.getElementById('edit-purchaseDate').value = asset.purchaseDate || '';
            document.getElementById('edit-assetDescription').value = asset.description || '';
            document.getElementById('edit-modal').style.display = 'flex';
        }

        // ìˆ˜ì • í¼ ì €ì¥ ì²˜ë¦¬
        document.getElementById('edit-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const id = document.getElementById('edit-id').value;
            const idx = assets.findIndex(a => a.id === id);
            if (idx === -1) return;
            assets[idx] = {
                ...assets[idx],
                name: document.getElementById('edit-assetName').value,
                modelName: document.getElementById('edit-modelName').value,
                serialNumber: document.getElementById('edit-serialNumber').value,
                category: document.getElementById('edit-assetCategory').value,
                location: document.getElementById('edit-assetLocation').value,
                value: parseInt(document.getElementById('edit-assetValue').value) || 0,
                purchaseDate: document.getElementById('edit-purchaseDate').value,
                description: document.getElementById('edit-assetDescription').value
            };
            localStorage.setItem('assets', JSON.stringify(assets));
            closeEditModal();
            displayAssets();
            updateStats();
            alert('ìì‚° ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
        });

        // ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°
        function closeEditModal() {
            document.getElementById('edit-modal').style.display = 'none';
        }

        displayAssets();
        updateStats();
    </script>
</body>
</html>
